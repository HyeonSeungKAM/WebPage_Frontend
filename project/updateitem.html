<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>물품등록</title>
    <link href="css/bootstrap.css" rel="stylesheet" />
    <!-- item2.html은 p36 자바스크립트 학습용으로 만들어짐 -->
    <!--스타일 정의-->
    <style>
        .board_container {
            width: 800px;
            padding: 20px;
            margin: 30px auto 0px auto;
        }

        .margin20 {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="shadow board_container">
        <!--페이지 제목-->
        <h3>물품등록</h3>
        <hr />

        <!--물품명-->
        <div class="row g-3 align-items-center margin20">
            <div class="col-auto">
                <label for="i_name" style="width:80px;" class="col-form-label">물품명</label>
            </div>
            <div class="col-auto">
                <input type="text" id="i_name" class="form-control" placeholder="물품명을 입력하세요" />
            </div>
        </div>

        <!--물품가격-->
        <div class="row g-3 align-items-center margin20">
            <div class="col-auto">
                <label for="i_name" style="width:80px;" class="col-form-label">물품가격</label>
            </div>
            <div class="col-auto">
                <input type="number" id="i_price" class="form-control" placeholder="물품명을 입력하세요" />
            </div>
        </div>

        <!--물품 관련 내용-->
        <div class="row g-3 align-items-center margin20">
            <div class="col-auto">
                <label for="i_name" style="width:80px;" class="col-form-label">물품내용</label>
            </div>
            <div class="col-auto">
                <input type="number" id="i_price" class="form-control" placeholder="물품 관련 내용을 입력하세요" />
            </div>
        </div>

        <label>물품명</label>
        <input tpye="text" id="i_name" /><br />

        <label>물품가격</label>
        <input tpye="number" id="i_price" /><br />

        <label>물품 관련 내용</label>
        <input tpye="number" id="i_content" /><br />

        <label>재고수량</label>
        <input tpye="number" id="i_quantity" /><br />

        <label>이미지</label>
        <img src="images/noimage.jpg" style="width:100px; height:100px;" id="img" />
        <input type="file" id="imgFile" onchange="handleImage(this)" /><br />

        <hr />

        <!-- 기본 이미지 클릭 시 이미지 선택창이 나타나도록 함 -->
        <!-- <input type='files'... /> 에서 display:none 이므로 "파일 선택 버튼이 나타나지 않음." -->
        <!-- <img src="images/noimage.jpg" 
            style="width:100px; height:100px; cursor: pointer;" 
            id="img1" onclick="clickImage()" />

        <input type="file" 
            onchange="handleImage1(this)" 
            style="display: none;" id="file1" /><br /> -->

        <button onclick="addItem()">물품등록</button>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

        let uploadImage;

        async function addItem() {
            // if(iname.value.length < 1) {
            //     alert('물품명을 입력하세요.');
            //     iname.focus();
            //     return false
            // }

            // if(price.value.length < 1) {
            //     alert('가격을 입력하세요.');
            //     price.focus();
            //     return false
            // }

            const url = `http://ihongss.com:13000/api/item/insert.json`;
            const headers = { "Content-Type": "multipart/form-data" }
            const body = {
                name: i_name.value,
                price: i_price.value,
                content: i_content.value,
                quantity: i_quantity.value,
                image: uploadImage
            }
            const { data } = await axios.post(url, body, { headers });
            console.log(data);
        };


        // 이미지 파일(정보 등) 선택 시 해당 파일로 바뀌는 함수( handleImage(this) ) 실행
        // 함수의 변수는 e로...
        function clickImage() {
            file1.click();
        }

        // function handleImage1(e) {
        //     console.log(e.files);
        //     console.log(e.files.length); // 1이면 첨부됨, 0이면 첨부되지 않음(취소)
        //     if(e.files.length===1) {
        //         //첨부 했음 (실제 파일 정보를 이용하여 표시)
        //         img1.src=URL.createObjectURL(e.files[0])
        //     } 
        //     else if(e.files.length===0) {
        //         //첨부하지 않았음 (image 폴더에 있는 noimage.jpg를 표시)
        //         img1.src="images/noimage.jpg"
        //     }
        // }

        function handleImage(e) {
            console.log(e.files);
            console.log(e.files.length); // 1이면 첨부됨, 0이면 첨부되지 않음(취소)
            if (e.files.length === 1) {
                //첨부 했음 (실제 파일 정보를 이용하여 표시)
                //첨부 시 noimage파일에서 첨부된 이미지 파일로 변경됨.
                img.src = URL.createObjectURL(e.files[0])
                return uploadImage = e.files[0]
            }
            else if (e.files.length === 0) {
                //첨부하지 않았음 (image 폴더에 있는 noimage.jpg를 표시)
                img.src = "images/noimage.jpg"
            }
        }

    </script>

</body>

</html>